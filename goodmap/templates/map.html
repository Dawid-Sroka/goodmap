{% extends "base.html" %}

{% block left_panel %}
<div id="filter-form"></div>
{% endblock %}

{% block content %}
<div id="map" class="map h-100 w-100"></div>
<script type="text/javascript">

    let activeFetchRequests = 0;
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        activeFetchRequests++;
        console.log('Fetch zapytanie rozpoczęte, aktywne:', activeFetchRequests);    return originalFetch(...args).then(response => {
            activeFetchRequests--;
            console.log('Fetch zapytanie zakończone, aktywne:', activeFetchRequests);
            return response;
        });
    };

    // Funkcja do sprawdzenia czy coś się ładuje
    function czyFetchLadowanieWTle() {
        return activeFetchRequests > 0;
    }

    let counter = 0;
    const intervalId = setInterval(() => {
        counter++;
        if (czyFetchLadowanieWTle() === false) {
            console.log("All done: Wszystkie zapytania się zakończyły")
            clearInterval(intervalId);
        }
        if (counter >= 20) {
            clearInterval(intervalId); // Stop the interval eventually
        }
    }, 400);

</script>
<script src="/static/map.js"></script>
{% endblock %}
